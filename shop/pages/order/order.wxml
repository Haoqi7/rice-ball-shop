<view class="container">
  <!-- é¡¶éƒ¨ï¼šèœå“åˆ†ç±» -->
  <view class="tabs">
    <view wx:for="{{categories}}" wx:key="*this" 
      class="tab-item {{curCategory===item?'active':''}}" 
      data-cat="{{item}}" bindtap="switchCategory">
      {{item}}
    </view>
  </view>

  <!-- ä¸­é—´ï¼šèœå“åˆ—è¡¨ -->
  <scroll-view scroll-y class="menu-list">
    <block wx:for="{{menuList}}" wx:key="id">
      <view class="menu-item card" wx:if="{{item.category === curCategory && item.isOn}}">
        <view class="menu-info">
          <view class="menu-header">
            <view class="menu-name">{{item.name}}</view>
            <view class="price-tag">ä¸€ä»½</view>
          </view>
          <view class="menu-desc">{{item.intro}}</view>
          
          <view class="menu-action">
            <view class="stepper">
              <view class="step-btn minus" catchtap="updateCart" data-id="{{item.id}}" data-op="-1" wx:if="{{cart[item.id] > 0}}">-</view>
              <view class="step-num" wx:if="{{cart[item.id] > 0}}">{{cart[item.id]}}</view>
              <view class="step-btn plus" catchtap="updateCart" data-id="{{item.id}}" data-op="1">+</view>
            </view>
          </view>
        </view>
      </view>
    </block>
    <!-- å«åº•é«˜åº¦å¢åŠ ï¼Œé˜²æ­¢è¢«åº•éƒ¨è®¢å•åˆ—è¡¨é®æŒ¡ -->
    <view style="height: 400rpx;"></view>
  </scroll-view>

  <!-- åº•éƒ¨åŒºåŸŸï¼šè´­ç‰©è½¦ + è®¢å•åˆ—è¡¨ -->
  <view class="bottom-area">
    
    <!-- 1. è´­ç‰©è½¦æ  (å¦‚æœæœ‰å•†å“é€‰ä¸­) -->
    <view class="cart-bar" wx:if="{{totalCount > 0}}">
      <view class="cart-info" bindtap="showCartDetail">
        <view class="cart-icon-wrap">ğŸ›’ <view class="badge">{{totalCount}}</view></view>
        <view class="cart-text">å·²é€‰ {{totalCount}} ä»½é¤ç‚¹</view>
      </view>
      <view class="pay-btn" bindtap="showSubmitModal">å»ä¸‹å•</view>
    </view>

    <!-- 2. æˆ‘çš„è®¢å•åˆ—è¡¨ (æ˜¾ç¤ºæœ€è¿‘çš„è®¢å•ï¼Œå¯æ»šåŠ¨) -->
    <view class="my-orders-panel" wx:if="{{myRecentOrders.length > 0}}">
      <view class="panel-header">æˆ‘çš„è®¢å• (ç‚¹å‡»æŸ¥çœ‹/å–æ¶ˆ)</view>
      <scroll-view scroll-y class="orders-scroll">
        <block wx:for="{{myRecentOrders}}" wx:key="id">
          <view class="mini-order-item" bindtap="navToDetail" data-id="{{item.id}}">
            <view class="order-left">
              <text class="order-time">{{item.timeStr}}</text>
              <text class="order-desc">å…± {{item.totalCount || 'è‹¥å¹²'}} ä»¶</text>
            </view>
            <view class="order-right">
              <text class="status-tag {{item.status}}">{{item.statusText}}</text>
              <text class="arrow">></text>
            </view>
          </view>
        </block>
      </scroll-view>
    </view>
  </view>

  <!-- å¼¹çª—1ï¼šè´­ç‰©è½¦è¯¦æƒ… -->
  <page-container show="{{showCartDetail}}" position="bottom" round>
    <view class="cart-detail-box">
      <view class="cart-header">
        <text>å·²é€‰å•†å“</text>
        <text class="clear-btn" bindtap="clearCart">æ¸…ç©º</text>
      </view>
      <view class="cart-list">
        <block wx:for="{{menuList}}" wx:key="id">
          <view class="cart-item" wx:if="{{cart[item.id] > 0}}">
            <text>{{item.name}}</text>
            <view class="stepper">
              <view class="step-btn minus" bindtap="updateCart" data-id="{{item.id}}" data-op="-1">-</view>
              <text class="step-num">{{cart[item.id]}}</text>
              <view class="step-btn plus" bindtap="updateCart" data-id="{{item.id}}" data-op="1">+</view>
            </view>
          </view>
        </block>
      </view>
    </view>
  </page-container>

  <!-- å¼¹çª—2ï¼šæäº¤è®¢å•ç¡®è®¤ -->
  <modal hidden="{{!showSubmitModal}}" title="ç¡®è®¤ä¸‹å•" confirm-text="æäº¤" cancel-text="å–æ¶ˆ" bindcancel="hideSubmitModal" bindconfirm="submitOrder">
    <view class="modal-content">
      <textarea class="remark-input" placeholder="å¤‡æ³¨ (å¦‚: å°‘é…±ã€åŠ æµ·è‹”...)" bindinput="inputRemark" value="{{remark}}"></textarea>
      <input class="pwd-input" type="number" password placeholder="è¯·è¾“å…¥è®¢å•å¯†ç " bindinput="inputPwd" value="{{inputPwd}}"/>
    </view>
  </modal>
</view>