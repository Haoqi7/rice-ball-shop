<view class="container">
  <!-- 登录锁 -->
  <view wx:if="{{!isLogged}}" class="login-box card">
    <view class="text-center text-lg">管理员登录</view>
    <input type="number" password class="modal-input" placeholder="输入管理密码 (默认123456)" bindinput="inputAdminPwd" />
    <button class="btn-primary" bindtap="login">进入管理</button>
    <view class="text-center text-sm" style="margin-top:20rpx; text-decoration:underline" bindtap="showForgot">忘记密码？</view>
  </view>

  <!-- 管理面板 -->
  <view wx:else>
    <view class="card">
      <view class="text-lg" style="margin-bottom:20rpx;">基础设置</view>
      <view class="setting-item">
        <text>店铺名称</text>
        <input class="input-inline" value="{{tempConfig.shopName}}" data-field="shopName" bindblur="updateConfigItem" />
      </view>
      <view class="setting-item">
        <text>欢迎语</text>
        <input class="input-inline" value="{{tempConfig.welcomeMsg}}" data-field="welcomeMsg" bindblur="updateConfigItem" />
      </view>
      <view class="setting-item">
        <text>下单须知</text>
        <input class="input-inline" value="{{tempConfig.notice}}" data-field="notice" bindblur="updateConfigItem" />
      </view>
    </view>

    <view class="card">
      <view class="text-lg" style="margin-bottom:20rpx;">菜品管理 (云端同步)</view>
      <button class="btn-primary" style="margin-bottom:20rpx" bindtap="addDish">新增菜品</button>
      <view wx:for="{{menuList}}" wx:key="id" class="dish-item-row">
        <view class="dish-name">
            <text style="font-weight:bold">{{item.name}}</text>
            <text wx:if="{{!item.isOn}}" style="color:red; font-size:24rpx; margin-left:10rpx">(下架)</text>
        </view>
        <view>
            <button size="mini" bindtap="editDish" data-id="{{item.id}}">编辑</button>
            <button size="mini" type="warn" bindtap="deleteDish" data-id="{{item.id}}" style="margin-left:10rpx">删</button>
        </view>
      </view>
    </view>

    <view class="card">
      <view class="text-lg" style="margin-bottom:20rpx;">安全设置</view>
      <button class="btn-main" bindtap="openPwdModal">修改密码 (管理/下单)</button>
    </view>
    
    <view style="margin-top: 40rpx; padding: 20rpx;">
        <button type="warn" bindtap="clearAllOrderData">⚠️ 清空所有历史订单</button>
        <view class="text-center text-sm" style="color:#999; margin-top:10rpx">保留菜品和设置，仅删除订单</view>
    </view>

    <button class="btn-danger" bindtap="logout" style="margin-top:20rpx; margin-bottom: 50rpx;">退出登录</button>
  </view>

  <!-- 编辑菜品弹窗 -->
  <modal hidden="{{!showDishModal}}" title="{{isEdit?'编辑菜品':'新增菜品'}}" confirm-text="保存" cancel-text="取消" bindconfirm="saveDish" bindcancel="closeDishModal">
    <input class="modal-input" placeholder="菜名" value="{{editingDish.name}}" data-field="name" bindinput="inputDish" />
    <input class="modal-input" placeholder="简介" value="{{editingDish.intro}}" data-field="intro" bindinput="inputDish" />
    
    <!-- 【修改点】range增加了 '炒菜' -->
    <picker mode="selector" range="{{['主食', '炒菜', '配料', '饮品']}}" bindchange="pickCategory">
       <view class="modal-input">分类：{{editingDish.category}} (点击修改)</view>
    </picker>
    
    <view style="margin-top:20rpx">
        <switch checked="{{editingDish.isOn}}" bindchange="switchIsOn">是否上架</switch>
    </view>
  </modal>

  <!-- 修改密码弹窗 -->
  <modal hidden="{{!showPwdChangeModal}}" title="修改密码" confirm-text="确认修改" cancel-text="取消" bindconfirm="savePasswordChange" bindcancel="closePwdModal">
    <view class="modal-content">
        <view class="text-sm" style="color:#666; margin-bottom:10rpx">验证旧管理密码:</view>
        <input class="modal-input" password placeholder="请输入当前管理密码" bindinput="inputOldAdminPwd" />
        <view style="border-top:1px dashed #eee; margin: 20rpx 0;"></view>
        <view class="text-sm" style="color:#666; margin-bottom:10rpx">新管理密码 (留空不改):</view>
        <input class="modal-input" password placeholder="新管理员密码" bindinput="inputNewAdminPwd" />
        <view class="text-sm" style="color:#666; margin-bottom:10rpx">新下单密码 (留空不改):</view>
        <input class="modal-input" type="number" placeholder="新下单密码" bindinput="inputNewOrderPwd" />
    </view>
  </modal>
</view>